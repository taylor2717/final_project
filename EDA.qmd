---
title: "Exploratory Data Analysis: Diabetes Health Indicators"
author: "Taylor Burke"
format:
  html:
    toc: true
    toc-depth: 3
execute:
  echo: true
  warning: false
  message: false
---
```{r setup}
#| label: setup
#| include: true

# Load required packages
library(tidyverse)   # data wrangling, plots
library(janitor)     # clean variable names
library(skimr)       # data summaries

# Set a reproducible seed
set.seed(123)
```

## Introduction

In this analysis, I explore the Diabetes Health Indicators dataset (diabetes_binary_health_indicators_BRFSS2015.csv), which is based on the Behavioral Risk Factor Surveillance System (BRFSS) survey.

- Response variable: Diabetes_binary
  - 0 = No diabetes
  - 1 = Diabetes
- Goal of EDA:
  - Understand the distribution of key health indicators.
  - Explore how these indicators relate to diabetes status.
  - Prepare for building predictive models in the Modeling document.

I focus on the following predictors (a subset of the full data):

  - HighBP – high blood pressure
  - HighChol – high cholesterol
  - BMI – body mass index (numeric)
  - Smoker – has smoked at least 100 cigarettes
  - PhysActivity – physical activity in past 30 days
  - GenHlth – general health (1 = excellent to 5 = poor)
  - MentHlth – days of poor mental health
  - PhysHlth – days of poor physical health
  - DiffWalk – serious difficulty walking
  - Sex – biological sex
  - Age – age category
  - Income – income category

These variables will form the basis of my later predictive modeling.

## Data Import and Cleaning


```{r}
#| label: import-data
#| message: true

# Read data from folder
raw_diabetes <- read_csv(
"diabetes_binary_health_indicators_BRFSS2015.csv"
)

# Clean column names to be snake_case
diabetes <- raw_diabetes %>%
clean_names()

# Inspect the structure
glimpse(diabetes)
```
### Converting Variables to Factors

Many columns are coded as 0/1 or numeric categories, but conceptually are categorical.
Here I convert them to factors with meaningful labels where appropriate.

```{r}
#| label: factor-conversion

diabetes <- diabetes %>%
mutate(
# Response as factor
diabetes_binary = factor(diabetes_binary,
levels = c(0, 1),
labels = c("NoDiabetes", "Diabetes")),
high_bp   = factor(high_bp,   levels = c(0, 1),
                   labels = c("NoHighBP", "HighBP")),
high_chol = factor(high_chol, levels = c(0, 1),
                   labels = c("NoHighChol", "HighChol")),
smoker    = factor(smoker,    levels = c(0, 1),
                   labels = c("NonSmoker", "Smoker")),
phys_activity = factor(phys_activity, levels = c(0, 1),
                       labels = c("NoPA", "PhysActive")),
diff_walk = factor(diff_walk, levels = c(0, 1),
                   labels = c("NoDiffWalk", "DiffWalk")),
sex       = factor(sex,       levels = c(0, 1),
                   labels = c("Female", "Male")),

# General health coded 1–5 (1 = excellent, 5 = poor)
gen_hlth = factor(gen_hlth,
                  levels = 1:5,
                  labels = c("Excellent", "VeryGood", "Good",
                             "Fair", "Poor")),

# Age categories and income categories as ordered factors
age = factor(age, ordered = TRUE),
income = factor(income, ordered = TRUE)
)

# Quick look after conversions
diabetes %>%
select(diabetes_binary, high_bp, high_chol, smoker,
phys_activity, diff_walk, sex, gen_hlth, age, income) %>%
summary()
```
### Missingness

Before any analysis, I check for missing values.

```{r}
#| label: missingness

# Count missing values per column

missing_summary <- diabetes %>%
summarise(across(everything(), ~ sum(is.na(.)))) %>%
pivot_longer(everything(),
names_to = "variable",
values_to = "n_missing") %>%
arrange(desc(n_missing))

missing_summary
```

## Overall Outcome Balance

First, I check how many respondents are labeled with diabetes vs. no diabetes.

```{r}
#| label: outcome-balance

diabetes %>%
count(diabetes_binary) %>%
mutate(prop = n / sum(n))
```

### Bar Plot of Outcome
```{r}
#| label: outcome-plot
#| fig.cap: "Distribution of Diabetes Outcomes"

diabetes %>%
ggplot(aes(x = diabetes_binary)) +
geom_bar() +
labs(
x = "Diabetes Status",
y = "Count",
title = "Counts of Diabetes vs. No Diabetes"
)
```

This plot shows class imbalance (typically many more NoDiabetes than Diabetes cases),
which I must keep in mind when choosing modeling strategies and evaluation metrics such as log-loss.

## Univariate Summaries of Key Predictors

### Numeric Variables (BMI, Mental & Physical Health Days)

```{r}
#| label: numeric-summaries

diabetes %>%
select(bmi, ment_hlth, phys_hlth) %>%
skim()
```
```{r}
#| label: bmi-hist
#| fig.cap: "Histogram of BMI"

diabetes %>%
ggplot(aes(x = bmi)) +
geom_histogram(bins = 30) +
labs(
title = "Distribution of BMI",
x = "BMI",
y = "Count"
)
```

I expect BMI to be right-skewed and generally higher in individuals with diabetes.
Understanding its distribution helps inform whether transformations might be needed.

### Categorical Variables

```{r}
#| label: cat-summaries

diabetes %>%
select(high_bp, high_chol, smoker, phys_activity, diff_walk,
sex, gen_hlth, age, income) %>%
map(~ count(as.data.frame(.), .))  # quick counts
```

The output shows the frequency of each category for these predictors.

## Bivariate Relationships With Diabetes

### BMI vs Diabetes Status

```{r}
#| label: bmi-diabetes
#| fig.cap: "BMI by Diabetes Status"

diabetes %>%
ggplot(aes(x = diabetes_binary, y = bmi)) +
geom_boxplot() +
labs(
title = "BMI by Diabetes Status",
x = "Diabetes Status",
y = "BMI"
)

```

I typically see higher median BMI among those with diabetes, suggesting BMI is a strong predictor for the modeling stage.

### High Blood Pressure and Diabetes

```{r}
#| label: highbp-diabetes
#| fig.cap: "Proportion with High Blood Pressure by Diabetes Status"

diabetes %>%
count(diabetes_binary, high_bp) %>%
group_by(diabetes_binary) %>%
mutate(prop = n / sum(n)) %>%
ggplot(aes(x = diabetes_binary, y = prop, fill = high_bp)) +
geom_col(position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "High Blood Pressure Status by Diabetes Outcome",
x = "Diabetes Status",
y = "Proportion",
fill = "High BP"
)
```
The proportion of individuals with high blood pressure tends to be higher among those with diabetes,
which indicates a strong association and usefulness as a predictor.

### General Health and Diabetes

```{r}
#| label: genhlth-diabetes
#| fig.cap: "General Health vs Diabetes Status"

diabetes %>%
ggplot(aes(x = gen_hlth, fill = diabetes_binary)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "General Health and Diabetes Outcome",
x = "Self-reported General Health",
y = "Proportion",
fill = "Diabetes Status"
)

```
Those reporting worse general health (Fair, Poor) appear more likely to have diabetes,
which is consistent with medical expectations.

### Physical Activity and Diabetes

```{r}
#| label: physact-diabetes
#| fig.cap: "Physical Activity vs Diabetes Status"

diabetes %>%
ggplot(aes(x = phys_activity, fill = diabetes_binary)) +
geom_bar(position = "fill") +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Physical Activity and Diabetes Outcome",
x = "Physical Activity in Past 30 Days",
y = "Proportion",
fill = "Diabetes Status"
)
```

Individuals with diabetes are more likely to report no recent physical activity.
This supports including physical activity as a predictor.

## Summary and Transition to Modeling

In this EDA, I:

  - Cleaned the dataset and converted key variables to factors.
  - Checked for missingness and outcome imbalance.
  - Explored distributions and relationships between predictors and diabetes status.

Several predictors (e.g., BMI, HighBP, GenHlth, PhysActivity, DiffWalk)
show meaningful associations with diabetes, making them good candidates for a predictive model.

Next, I will:

  - Split the data into training and test sets.
  - Fit and compare classification tree and random forest models using log-loss.
  - Select a final “best” model for deployment as an API.
